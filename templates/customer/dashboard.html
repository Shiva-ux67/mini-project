{% extends "customer/base_customer.html" %}

{% block title %}Customer Dashboard{% endblock %}

{% block content %}

<div class="stats-grid animate-slide-up">
    <div class="stat-card" style="border-left-color: var(--customer-primary);">
        <span class="stat-label">Available Files</span>
        <!-- Assuming messages is a dict passed to the template -->
        <span class="stat-value" style="color: var(--customer-primary);">{{ messages|length }}</span>
        <p class="stat-desc">Encrypted records in your vault</p>
    </div>

    <div class="stat-card" style="border-left-color: var(--success);">
        <span class="stat-label">Account Status</span>
        <span class="stat-value" style="color: var(--success);">Active</span>
        <p class="stat-desc">Full access to security tools</p>
    </div>
</div>

<div class="card animate-slide-up"
    style="animation-delay: 0.1s; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h4 style="font-size: 1.25rem; color: var(--gray-800); margin-bottom: 0.5rem;">Security Marketplace</h4>
        <p style="color: var(--gray-500); font-size: 0.9rem;">Browse and procure high-level cryptographic hardware.</p>
    </div>
    <a href="{{ url_for('customer_products') }}" class="btn btn-primary">Browse Products</a>
</div>

<div class="table-container animate-slide-up" style="animation-delay: 0.2s;">
    <div
        style="background: linear-gradient(135deg, var(--customer-primary) 0%, var(--customer-dark) 100%); padding: 1.5rem; border-bottom: 1px solid var(--gray-200); border-radius: 12px 12px 0 0;">
        <h3 style="font-size: 1.1rem; font-weight: 600; color: white;">Recent Evidence</h3>
    </div>
    <table>
        <thead>
            <tr>
                <th>Sender</th>
                <th>Payload Snippet</th>
                <th>Received</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for msg_id, msg in messages.items() %}
            <tr>
                <td style="font-weight: 600;">{{ msg.sender }}</td>
                <td>
                    <div class="code-block"
                        style="display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">
                        {{ msg.encrypted_content[:15] }}...
                    </div>
                </td>
                <td style="color: var(--gray-500); font-size: 0.9rem;">{{ msg.timestamp }}</td>
                <td>
                    <a href="{{ url_for('customer_decrypt', msg_id=msg_id) }}" class="btn btn-primary"
                        style="padding: 0.4rem 1rem; font-size: 0.8rem;">View</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" style="text-align: center; color: var(--gray-400); padding: 3rem;">No messages found in
                    your secure vault.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}